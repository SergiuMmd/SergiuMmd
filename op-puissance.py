import pip
import discord
from discord.ext import commands
from discord import utils
rôlesg = {"828566806528393216": 0, "828565222981238784": 0, "827643462954123306": 0, "818932737142554644": 0, "817307758201405440": 0, "817130023428292660": 0, "806577590713319466": 0, "804048169612738611": 0, "799526583127375874": 0, "798586375661551640": 0, "793773809882759189": 0, "793403590651281439": 0, "787988823095115777": 0, "776028641640841228": 0, "776027215741190146": 0, "776029020256075777": 0, "776027072886865921": 0, "776026517259157535": 0, "776027996355690497": 0, "776027559108280351": 0, "776029836032475157": 0, "776029593701449729": 0, "783715761373970442": 0, "783709041721081856": 0, "783709039926181918": 0, "783709039875457064": 0, "783709038101528576": 0, "783709038034681876": 0, "783709037769523241": 0, "786909985447739392": 0, "775043294072668220": 0, "827643492943003678": 0, "786909994674552833": 0, "775043293049257985": 0, "825752229599772682": 0, "819135106861891624": 0, "814417384915206194": 0, "800650832714268744": 0, "798588493751517215": 0, "777495212339625985": 0, "783676859018772510": 10000, "783676857454297088": 5000, "783676856733532160": 4000, "782922384436232213": 4500, "782922383135735848": 2500, "782922383006498826": 2000, "782922382154924042": 1500, "782922380891783191": 3500, "803170126396260374": 30000, "782922377587458058": 10000, "782922376907849768": 8000, "782922380808552469": 7000, "782922375577468929": 5000, "782922375947354122": 4000, "782922374785925122": 3500, "782922378610999296": 2500, "782922373049090068": 2500, "803170126727872552": 0, "782922378623320074": 2000, "782922374231359488": 1500, "782922373158535178": 1500, "782922377616687104": 1000, "803170124391514163": 5000, "803170123817025546": 20000, "782922372960878642": 10000, "782922372914479124": 3000, "782922372948033536": 3000, "782922372868997121": 3000, "782922372839374879": 3000, "782922372914348032": 3000, "782922372864016434": 3000, "782922356686716937": 0, "782922372813815829": 10000, "782922372730454067": 6000, "782922372688642059": 3000, "783703163101642754": 4000, "819135104101908530": 7000, "783703164950937640": 6000, "783703163328135199": 3000, "819135104059834418": 2000, "783703163319615528": 500, "782922372990107648": 0, "814417381404442664": 0, "814417382474776586": 0, "814417382550142996": 0, "814417383753252864": 0, "814417383774486549": 0, "814417384844296193": 0, "814417384877981696": 0, "784045131475976213": 0, "803170134092939304": 0, "777500495634890783": 5000, "777500496055107586": 10000, "777500496880730122": 15000, "777500497938612234": 20000, "777500498369970176": 25000, "777500498957303838": 50000, "814417378409971742": 75000, "814417379290644490": 10000, "814417379332587540": 150000, "777500492317851648": 2000, "777500492955385917": 4000, "777500493567754260": 6000, "777500493697908758": 8000, "777500494578712586": 10000, "777500495295283200": 20000, "814417379878371340": 30000, "814417380272504842": 50000, "814417381384257567": 75000, "777500490720083989": 2000, "777500491092459531": 4000, "777500491117887558": 6000, "777500491126800404": 7000, "777500491156160523": 10000, "777500491709546557": 20000, "814417376224346173": 30000, "814417376514539521": 50000, "814417377701003316": 75000, "782922356309098536": 0, "783676862693507092": 0, "777495226361184266": 500, "777495226826620928": 1000, "777495227602567178": 1500, "777495228030386206": 2000, "777495228714057729": 2500, "777495229317251082": 5000, "777500485606572054": 7500, "777500485954568213": 15000, "777500487003013160": 15000, "777495219456180235": 500, "777495220362674177": 1000, "777495221025636352": 1500, "777495221629616138": 2000, "777495222308306964": 2500, "777495223134715914": 5000, "777495223684169738": 7500, "777495224234672158": 10000, "777495225022939167": 15000, "777495213920223252": 500, "777495215056355348": 1000, "777495215296610314": 1500, "777495215312601109": 2000, "777495216185540623": 2500, "777495216868294666": 5000, "777495216969613373": 7500, "777495218207195163": 10000, "777495218702385172": 15000, "817307735934238760": 75000, "817307751159431289": 150000, "817307751347781663": 225000, "782922356028080139": 0, "777495212082724885": 0, "776842758164840458": 0, "783709036767739914": 0, "777495208320696331": 0, "776842757641601024": 0, "776842755829006387": 0, "776842756629856256": 0, "776842755308912660": 0, "776842754700476496": 0, "776842754223112262": 0, "783709036566151249": 1000, "783709034438983701": 3000, "783709034817519636": 500, "775035351860248588": 5000, "775035353199411200": 1500, "775035350836838440": 1500, "775035351579885568": 2000, "775035350292234250": 500, "776842753161166849": 0, "776842752217579520": 0, "776848569935986708": 0, "776028136868937728": 0, "777495213451116566": 0, "776842753492647936": 0, "776842745242845235": 0, "776838132263813171": 0, "776842747930869810": 0, "776842747364900934": 0, "776842751249612810": 0, "776842750557028392": 0, "776842749730226246": 0, "776842749411852288": 0, "776842746698006528": 0, "776838129557831702": 0, "776838128778346536": 0, "776838127956262922": 0, "775035354863370250": 0, "818073496378277899": 0, "775035354750386216": 0, "827643471476555816": 0, "776838127088173106": 0, "776838125695139890": 0, "776838125157744691": 0, "776838124545638440": 0, "776838123673616395": 0, "776838124130402334": 0, "776838122797006869": 0, "775043292265578548": 0, "776838122293035078": 0, "775043291736834059": 0, "775043290524418060": 0, "775043290324140032": 0, "819135105556938752": 0, "775035353340837929": 0, "817307756415156234": 0, "775035347176128523": 0, "775035344272752654": 0, "775035343912828939": 0, "775035342964523028": 0, "775035347112951818": 0, "775034297052037151": 0, "783718285995933708": 0}
rôlesc = {"782922360172183583": 1000, "782922360457396274": 2000, "782922361111969802": 3000, "782922361963937792": 4000, "782922362801618984": 5000, "782922372519952395": 10000, "782922372536729611": 15000, "782922372612096021": 20000, "782922372688510997": 30000, "782922359551426610": 1.5, "782922358788718592": 1, "782922358696050698": 2}
rôlesp = {"783703155783237632": 1000, "783703157271298079": 2000, "783703157351776266": 3000, "783703159113383997": 4000, "783703159187963935": 5000, "783703159427301416": 10000, "783703159435690034": 15000, "783703161067929611": 30000, "783703161181175810": 30000, "817307758210580491": 1, "817307758323302430": 1.5, "819135101907501097": 2, "819135102356946974": 2.5, "819135103854575638": 3}
lb = {'539022078200774696': 278500, '570699215412658177': 331000, '588824788378583046': 108500, '304062173896900609': 313000, '461332212231438337': 4500, '361865688434081792': 335000, '800041300007059477': 194000, '790659037267623966': 223000, '748111696698277918': 140000, '378544192995065868': 53000, '657645197387104271': 122500, '281871548506439680': 109500, '522122322245582889': 269500, '638061738352443393': 187000, '366244069896355842': 115500, '707231154972917792': 160500, '777837201392271370': 74500}
entier = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "0"]

def Power(ctx, roles_modifies):
  power = 0
  powerc = 0
  powerp = 0
  multiplicateurc = 1
  multiplicateurp = 1
  for roles in roles_modifies:
    if str(roles.id) in rôlesg:
      power += rôlesg[str(roles.id)]
    if str(roles.id) == "782922358788718592":
      multiplicateurc = 1
      continue
    if str(roles.id) == "782922359551426610":
      multiplicateurc = 1.5
      continue
    if str(roles.id) == "782922358696050698":
      multiplicateurc = 2
      continue
    if str(roles.id) == "817307758210580491":
      multiplicateurp = 1
      continue
    if str(roles.id) == "817307758323302430":
      multiplicateurp = 1.5
      continue
    if str(roles.id) == "819135101907501097":
      multiplicateurp = 2
      continue
    if str(roles.id) == "819135102356946974":
      multiplicateurp = 2.5
      continue
    if str(roles.id) == "819135103854575638":
      multiplicateurp = 3
      continue
    if str(roles.id) in rôlesc:
      powerc += rôlesc[str(roles.id)]
    if str(roles.id) in rôlesp:
      powerp += rôlesp[str(roles.id)]
  power += int(powerc*multiplicateurc + powerp*multiplicateurp)
  return power

def Leaderboard(ctx, page):
  lb2 = {}
  listps = list(lb.values())
  listps.sort(reverse = True)
  for keys, values in lb.items():
    if values == 0:
      continue
    lb2[values] = int(keys)
  message = "**Voici le classement que tu as demandé (page " + str(page) + "):**" + "\n" + "\n"
  if len(listps) >= page*20 :
    d = 20 * (page - 1)
    f = 20 * page
  else:
    while len(listps) < page*20:
      page -=1
    d = 20 * page
    f = len(listps)
  for x in range(d, f):
    idd = lb2[listps[x]]
    if ctx.guild.get_member(idd) != None:
      message = message + "**" + str(x+1) + "°)  "+ ctx.guild.get_member(idd).nick + "  ➞  " + str(listps[x]) + "** :muscle: \n"
    else:
      lb.pop(str(idd))
  message = message + "\n" + "**Notez que les Super Weapons comptent ici à valeur minimale (7.000 :muscle:).**"
  return message


class Puissance(commands.Cog):
  @commands.command()
  async def puissance(self, ctx):
    if ctx.guild.id != 775016004514086923 and ctx.guild.id != 700641156643553301:
      await ctx.send("**Désolé mais cette commande ne peut pas être utilisée sur ce serveur.**")
      return
    author = ctx.message.author
    message = author.mention
    if len(ctx.message.mentions) == 1:
      author = ctx.message.mentions[0]
    member = ctx.guild.get_member(author.id)
    roles_modifies = member.roles
    power = Power(ctx, roles_modifies)
    lb[str(member.id)] = power
    if len(ctx.message.mentions) == 1:
      message = message + ", " + member.mention + " a **" + str(power) + "** points de puissance, bravo à lui :clap:!"
    else:
      message = "Salut **" + message + "**! Tu as **" + str(power) + "** points de puissance mousaillon :muscle:!"
    await ctx.send(message)
  
  @commands.command()
  async def classement(self, ctx):
    if ctx.guild.id != 775016004514086923 and ctx.guild.id != 700641156643553301:
      await ctx.send("**Désolé mais cette commande ne peut pas être utilisée sur ce serveur.**")
      return
    author = ctx.message.author
    contenu = ctx.message.content
    contenu = contenu.split()
    if len(contenu) == 1:
      message = Leaderboard(ctx, 1)
      await ctx.send(message)
    elif len(contenu) == 2:
      if contenu[1].isnumeric() == True:
        message = Leaderboard(ctx, int(contenu[1]))
        await ctx.send(message)
      else:
        await ctx.send("Je ne comprends rien. Mets un **nombre entier (comme 2 par exemple)** s'il te plaît.")
    else:
      await ctx.send("Je ne comprends rien. Mets **qu'une valeur** s'il te plaît.")
  
  @commands.command()
  async def Récolte(self, ctx):
    print(lb)
    await ctx.send("**J'ai récolté les données du classement!**")



def setup(client):
    client.add_cog(Puissance(client))